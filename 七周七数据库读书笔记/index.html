<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记 - 实用后端技术</title><meta name=Description content="实用后端技术"><meta property="og:title" content="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记"><meta property="og:description" content="序 这篇分享不讲具体特性，不讲分布式实现，从使用场景和底层存储出发，了解核心概念，重在理解各类型数据库的本质和其设计带来的优缺点，为了帮助大家"><meta property="og:type" content="article"><meta property="og:url" content="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"><meta property="og:image" content="https://www.elonzh.com/logo.png"><meta property="article:published_time" content="2018-09-27T02:23:37+08:00"><meta property="article:modified_time" content="2018-09-27T02:23:37+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.elonzh.com/logo.png"><meta name=twitter:title content="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记"><meta name=twitter:description content="序 这篇分享不讲具体特性，不讲分布式实现，从使用场景和底层存储出发，了解核心概念，重在理解各类型数据库的本质和其设计带来的优缺点，为了帮助大家"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=https://www.elonzh.com/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://www.elonzh.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.elonzh.com/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=https://www.elonzh.com/apple-touch-icon.png><link rel=mask-icon href=https://www.elonzh.com/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=https://www.elonzh.com/site.webmanifest><link rel=canonical href=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/><link rel=prev href=https://www.elonzh.com/%E5%A5%87%E7%89%B9%E7%9A%84%E4%B8%80%E7%94%9F%E4%B9%A6%E8%AF%84/><link rel=next href=https://www.elonzh.com/%E8%AE%B0%E4%B8%80%E6%AC%A1-elastic-apm-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/><link rel=stylesheet href=https://www.elonzh.com/lib/normalize/normalize.min.css><link rel=stylesheet href=https://www.elonzh.com/css/style.min.css><link rel=stylesheet href=https://www.elonzh.com/lib/fontawesome-free/all.min.css><link rel=stylesheet href=https://www.elonzh.com/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.elonzh.com\/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0\/"},"genre":"posts","keywords":"数据库","wordcount":4333,"url":"https:\/\/www.elonzh.com\/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0\/","datePublished":"2018-09-27T02:23:37+08:00","dateModified":"2018-09-27T02:23:37+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Elon Zhou"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=https://www.elonzh.com/ title=实用后端技术></a></div><div class=menu><div class=menu-inner><a class=menu-item href=https://www.elonzh.com/>首页 </a><a class=menu-item href=https://www.elonzh.com/posts/>文章 </a><a class=menu-item href=https://www.elonzh.com/tags/>标签 </a><a class=menu-item href=https://www.elonzh.com/categories/>分类 </a><a class=menu-item href=https://www.elonzh.com/snippet/>代码片 </a><a class=menu-item href=https://www.elonzh.com/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=https://www.elonzh.com/ title=实用后端技术></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=https://www.elonzh.com/>首页</a><a class=menu-item href=https://www.elonzh.com/posts/>文章</a><a class=menu-item href=https://www.elonzh.com/tags/>标签</a><a class=menu-item href=https://www.elonzh.com/categories/>分类</a><a class=menu-item href=https://www.elonzh.com/snippet/>代码片</a><a class=menu-item href=https://www.elonzh.com/about/>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.elonzh.com/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Elon Zhou</a></span>&nbsp;<span class=post-category>收录于 <a href=https://www.elonzh.com/categories/%E9%98%85%E8%AF%BB/><i class="far fa-folder fa-fw"></i>阅读</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2018-09-27>2018-09-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4333 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#关于七周七数据库>关于《七周七数据库》</a></li></ul><ul><li><a href=#关系型relational-dbms>关系型(Relational DBMS)</a></li><li><a href=#键-值型key-value-stores>键-值型(Key-value Stores)</a></li><li><a href=#宽列型wide-column-stores>宽列型(Wide Column Stores)</a></li><li><a href=#文档型document-stores>文档型(Document stores)</a></li><li><a href=#mongodb>MongoDB</a></li><li><a href=#图型graph-dbms>图型(Graph DBMS)</a></li></ul></nav></div></div><div class=content id=content><h1 id=序>序</h1><p>这篇分享不讲具体特性，不讲分布式实现，从使用场景和底层存储出发，了解核心概念，重在理解各类型数据库的本质和其设计带来的优缺点，为了帮助大家理解，本文部分知识超出了书本内容，顺序也做了相应调整。</p><h2 id=关于七周七数据库>关于《七周七数据库》</h2><ul><li>不建议花大量时间去完成新手实践的内容，实际需要时再去了解也不迟，重在扩充知识面。</li><li>最有价值的是附录和每一章的总结，这两个部分看懂了，整本书就差不多了。</li><li>翻译一般。</li></ul><h1 id=从场景出发---oltp-vs-olap>从场景出发 - OLTP vs. OLAP</h1><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/olap_vs_oltp.jpg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/olap_vs_oltp.jpg, img/olap_vs_oltp.jpg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/olap_vs_oltp.jpg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/olap_vs_oltp.jpg title=olap_vs_oltp></p><p>数据处理大致可以分成两大类：</p><ul><li>联机事务处理OLTP（On-Line Transaction Processing）</li><li>联机分析处理OLAP（On-Line Analytical Processing）。</li></ul><p>OLTP是传统的关系型数据库的主要应用，主要是基本的、日常的事务处理，例如银行交易。
OLAP是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。</p><p>OLTP 系统强调数据库内存效率，强调内存各种指标的命令率，强调绑定变量，强调并发操作；
OLAP 系统则强调数据分析，强调SQL执行市场，强调磁盘I/O，强调分区等。</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/oltp_olap.png data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/oltp_olap.png, img/oltp_olap.png 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/oltp_olap.png 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/oltp_olap.png title=oltp_olap></p><h1 id=从存储出发---数据规模与数据复杂度之间的关系>从存储出发 - 数据规模与数据复杂度之间的关系</h1><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/nosql.jpg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/nosql.jpg, img/nosql.jpg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/nosql.jpg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/nosql.jpg title=nosql></p><p>上图是下面介绍的几种 NoSQL 数据库数据规模与数据复杂度之间的关系，我们可以看到，一种数据库实现时，要想承载更大的数据规模，其数据复杂度必须要随之下降，因为关系简单的数据更易进行分片和复制。</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/00020.jpeg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00020.jpeg, img/00020.jpeg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00020.jpeg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00020.jpeg title=00020></p><p>接下来简单介绍传统关系型数据库，然后按照横轴方向介绍几种类型的数据库。</p><h1 id=几种常见数据库类型>几种常见数据库类型</h1><h2 id=关系型relational-dbms>关系型(Relational DBMS)</h2><p>关系数据库，是创建在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/Relational_model_concepts.png data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/Relational_model_concepts.png, img/Relational_model_concepts.png 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/Relational_model_concepts.png 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/Relational_model_concepts.png title=Relational_model_concepts></p><p>表（关系Relation）是以行（属性Attribute）和列（值组Tuple）的形式组织起来的数据的集合。一个数据库包括一个或多个表（关系Relation）。例如，可能有一个有关作者信息的名为authors的表（关系Relation）。每列（值组Tuple）都包含特定类型的信息，如作者的姓氏。每行（属性Attribute）都包含有关特定作者的所有信息：姓、名、住址等等。在关系型数据库当中一个表（关系Relation）就是一个关系，一个关系数据库可以包含多个表（关系Relation）</p><p>关系型数据库的优势在于严格的约束，强一致性和支持灵活的查询，缺点是对水平扩容支持比较差，目前主要高可用方案是通过主从复制实现，数据的水平扩展可以通过分区，分库，分表等策略实现，但是无论是哪种方式，都会有以下问题。</p><ul><li>事务问题</li></ul><p>在执行分库分表之后，由于数据存储到了不同的库上，数据库事务管理出现了困难。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价；如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。</p><ul><li>跨库跨表的join问题</li></ul><p>在执行了分库分表之后，难以避免会将原本逻辑关联性很强的数据划分到不同的表、不同的库上，这时，表的关联操作将受到限制，我们无法join位于不同分库的表，也无法join分表粒度不同的表，结果原本一次查询能够完成的业务，可能需要多次查询才能完成。</p><ul><li>额外的数据管理负担和数据运算压力</li></ul><p>额外的数据管理负担，最显而易见的就是数据的定位问题和数据的增删改查的重复执行问题，这些都可以通过应用程序解决，但必然引起额外的逻辑运算，例如，对于一个记录用户成绩的用户数据表userTable，业务要求查出成绩最好的100位，在进行分表之前，只需一个order by语句就可以搞定，但是在进行分表之后，将需要n个order by语句，分别查出每一个分表的前100名用户数据，然后再对这些数据进行合并计算，才能得出结果。</p><h2 id=键-值型key-value-stores>键-值型(Key-value Stores)</h2><p>顾名思义，KV存储库将键与值配对，类似于所有流行编程语言中的映射（或哈希表）。某些KV实现允许复杂的值类型，如哈希或列表，但这不是必需的。</p><p>键-值型存储可能是数据库管理中最简单的形式，一般来说单纯的键值数据库是不能满足复杂应用的需求的，但是另一方面，其简单的特性让它在特定场景下的表现非常出色。</p><p>Riak 是一个分布式的键值数据库，支持 MapReduce 和水平扩容，Riak 允许通过改变三个值：N、W与R，来控制集群的读写。N是一次写入最终复制到的节点数量，换句话说，就是集群中的副本数量。W是一次成功地写入响应之前，必须成功写入的节点数量。如果W小于N，就认为某次写入是成功的，即使Riak依然在复制数据。最后，R是成功读出一项数据所必需的节点数量。如果R比可用的复制数量大，读出请求将会失败。其原理是一致哈希算法，具体逻辑可以阅读<a href=https://wizardforcel.gitbooks.io/the-art-of-programming-by-july/content/a.3.html target=_blank rel="noopener noreffer">编程之法：算法和面试心得 - 一致性哈希算法</a>。</p><p>而 Redis，从基本层面上说，它是一个键-值对存储库。但这种简单的说法并不全面。虽然 Redis 没有达到文档型数据库的程度，但它支持高级的数据结构。它支持基于集合的查询操作，但不支持关系数据库中同样的粒度或类型。当然，它很快，为了速度而在持久性方面作出了让步。</p><p>Redis 把自己定义为高级数据结构服务器，此外，它也是阻塞队列（或栈）和发布-订阅系统。它支持可配置的到期策略、持久性级别，以及复制选项。所有这些使得 Redis 不仅是某类数据库中的一员，更是有用的数据结构算法和程序的工具包。</p><h2 id=宽列型wide-column-stores>宽列型(Wide Column Stores)</h2><p>列型（或面向列的数据库）的命名源自于其设计的一个重要方面，即来自一个给定的列（在二维表的意义上）的数据存放在一起。相比之下，面向行的数据库（如RDBMS），将一行的信息保存在一起。这种差异看起来似乎无关紧要，但实际上这种设计决策的影响很深。在面向列的数据库中，添加列是相当简易的，而且是逐行完成的。每一行可以有一组不同的列，或完全没有，允许表保持稀疏（sparse），而不会产生空值的存储成本。在结构方面，列型数据库大约介于关系数据库和键-值存储库之间。</p><p>你可以把宽列型数据库可以看做是二维的键-值型数据库，就能理解其特性了。</p><p>在宽列型数据库中，竞争相比关系数据库或键-值存储较少。我们以 HBase 为例介绍下宽列型数据库的核心概念。</p><p>在HBase表中，键可以是任意字符串，每个键都映射到一行数据。行本身也是一个映射表，其中的键称为列，而值就是未解释的字节数组。列按照列族（column family）进行分组，所以列的完全名称包含两个部分：列族名称和列限定符（column qualifier）。通常它们用一个冒号连接起来（例如，&lsquo;family:qualifier&rsquo;）。</p><p>![HBase的表包含行、键、列族、列和值](img/图4-1 HBase的表包含行、键、列族、列和值.jpg)</p><p>在这张图中，有一张假想的表，它有两个列族：color和shape。该表有两行（虚线框表示），由行键来唯一标识：first和second。请看第一行，我们看到它在列族color中有3列（限定符分别是red、blue和yellow），在列族shape中有1列（square）。行键和列名（包括列族和限定符）的组合，形成了定位数据的地址。在这个例子中，三元组first/color:red指向了值&rsquo;#F00&rsquo;。</p><h2 id=文档型document-stores>文档型(Document stores)</h2><p>我们可以将文档型数据库理解为，值类型为文档的键值数据库，因为其核心的存储引擎实际上就是键值存储，每个文档的键是文档的位置信息，值为存储的文档。位置信息的核心就是每个文档的独一无二的标识符（但并不代表标识符就是文档的位置信息）。</p><p>也正因为值为文档，文档型数据库在数据结构上表现出了高度的灵活性，允许有可变域。该系统对输入的数据很少有限制，只要它满足基本要求，可以表示为一个文档。在建索引、自由定义的查询、复制、一致性及其他设计决策等方面，不同的文档数据库采取了不同的方法。</p><h2 id=mongodb>MongoDB</h2><p>MongoDB 是目前最为流行的 NoSQL 数据库，它是一种面向集合，模式无关的文档型数据库。其中数据以“集合(Collection)”的方式进行分组，每个集合都有单独的名称并可以包含无限数量的文档。这里的集合同关系型数据库中的表（table）类似，唯一的区别就是它并没有任何明确的结构，文档（Document）是集合中数据的最小单元，概念可以与关系型数据库中的行（row）对应。</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/00023.jpeg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00023.jpeg, img/00023.jpeg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00023.jpeg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00023.jpeg title=00020></p><p>虽然我们与 MongoDB 交互式时的数据是 JSON 格式的，但实际上 MongoDB 数据库中的数据存储和网络传输格式是 BSON，它是一种二进制表示形式，能用来表示简单数据结构、关联数组（MongoDB中称为“对象”或“文档”）以及MongoDB中的各种数据类型。BSON之名缘于JSON，含义为Binary JSON（二进制JSON）。</p><p>与JSON相比，BSON 着眼于提高存储和扫描效率。BSON 文档中的大型元素以长度字段为前缀以便于扫描。在某些情况下，由于长度前缀和显式数组索引的存在，BSON使用的空间会多于JSON。</p><h2 id=图型graph-dbms>图型(Graph DBMS)</h2><p>这是一种不太常用的数据库类型，图数据库善于处理高度互联的数据。图数据库包含节点及节点之间的关系。节点和关系可以有一些属性（一些键-值对），用来存储数据。图数据库的真正实力是按照关系遍历节点。</p><p>图型数据库通常不能提供所有节点的索引，根据属性值直接访问节点是无法实现的，必须要通过遍历。</p><p>图型数据库的代表是 Neo4j，Neo4j 被称为 property graph，除了顶点（Node）和边(Relationship，其包含一个类型)，还有一种重要的部分——属性。无论是顶点还是边，都可以有任意多的属性。属性的存放类似于一个哈希表，键为一个字符串，而值必须是 Java基本类型、或者是基本类型数组，比如说String、int或者int[]都是合法的。</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/%e5%9b%be.png data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%9B%BE.png, img/%e5%9b%be.png 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%9B%BE.png 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%9B%BE.png title=节点存储></p><p>在这个例子中，A~E表示 Node 的编号，R1~R7 表示 Relationship 编号，P1~P10 表示Property 的编号。</p><p>Node 的存储示例图如下,每个 Node 保存了第1个 Property 和 第1个 Relationship：</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/%e5%85%b3%e7%b3%bb%e5%ad%98%e5%82%a8.png data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png, img/%e5%85%b3%e7%b3%bb%e5%ad%98%e5%82%a8.png 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png title=关系存储></p><p>Relationship 的存储示意图如下：</p><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/%e5%85%b3%e7%b3%bb%e5%ad%98%e5%82%a8.png data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png, img/%e5%85%b3%e7%b3%bb%e5%ad%98%e5%82%a8.png 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/%E5%85%B3%E7%B3%BB%E5%AD%98%E5%82%A8.png title=关系存储></p><p>从示意图可以看出，从 Node-B 开始，可以通过关系的 next 指针，遍历Node-B 的所有关系，然后可以到达与其有关系的第1层Nodes,在通过遍历第1层Nodes的关系，可以达到第2层Nodes,…</p><h1 id=从-cap-定理出发>从 CAP 定理出发</h1><p>CAP理论主张任何基于网络的数据共享系统，都最多只能拥有以下三条中的两条：</p><ul><li>数据一致性（C），等同于所有节点访问同一份最新的数据副本；</li><li>对数据更新具备高可用性（A）；</li><li>能容忍网络分区（P）。</li></ul><h1 id=附录数据库对比表格>附录：数据库对比表格</h1><blockquote><p>来自《七周七数据库》，相关数据可能随时间发生变化</p></blockquote><p><img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/00068.jpeg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00068.jpeg, img/00068.jpeg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00068.jpeg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00068.jpeg title=关系存储>
<img class=lazyload src=https://www.elonzh.com/svg/loading.min.svg data-src=img/00042.jpeg data-srcset="https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00042.jpeg, img/00042.jpeg 1.5x, https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00042.jpeg 2x" data-sizes=auto alt=/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/img/00042.jpeg title=关系存储></p><h1 id=附录推荐阅读>附录：推荐阅读</h1><ul><li><a href=http://www.infoq.com/cn/articles/cap-twelve-years-later-how-the-rules-have-changed target=_blank rel="noopener noreffer">CAP理论十二年回顾：&ldquo;规则"变了</a></li><li><a href="http://www.ywnds.com/?p=12418" target=_blank rel="noopener noreffer">分布式数据库TiDB整体概述</a></li></ul><h1 id=参考链接>参考链接</h1><ul><li><a href=http://www.ireadweek.com/index.php/bookInfo/3556.html target=_blank rel="noopener noreffer">《七周七数据库》</a></li><li><a href=https://db-engines.com/en/system/InfluxDB target=_blank rel="noopener noreffer">https://db-engines.com/en/system/InfluxDB</a></li><li><a href=https://db-engines.com/en/article/Time+Series+DBMS target=_blank rel="noopener noreffer">https://db-engines.com/en/article/Time+Series+DBMS</a></li><li><a href=http://qinxuye.me/article/introduction-to-neo4j/ target=_blank rel="noopener noreffer">http://qinxuye.me/article/introduction-to-neo4j/</a></li><li><a href=https://db-engines.com/en/article/Graph+DBMS target=_blank rel="noopener noreffer">https://db-engines.com/en/article/Graph+DBMS</a></li><li><a href=http://blog.51cto.com/76287/885475 target=_blank rel="noopener noreffer">OLTP和OLAP浅析</a></li><li><a href=https://db-engines.com/en/article/Wide+Column+Stores target=_blank rel="noopener noreffer">https://db-engines.com/en/article/Wide+Column+Stores</a></li><li><a href=https://db-engines.com/en/article/Relational+DBMS target=_blank rel="noopener noreffer">https://db-engines.com/en/article/Relational+DBMS</a></li><li><a href=http://sunxiang0918.cn/2015/06/27/neo4j-%E5%BA%95%E5%B1%82%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/ target=_blank rel="noopener noreffer">Neo4j 底层存储结构分析</a></li><li><a href=https://blog.csdn.net/KingCat666/article/details/78324678 target=_blank rel="noopener noreffer">Sharding：分表、分库、分片和分区</a></li><li><a href=https://db-engines.com/en/article/Key-value+Stores target=_blank rel="noopener noreffer">Key-value Stores</a></li><li><a href=https://db-engines.com/en/system/HBase target=_blank rel="noopener noreffer">HBase</a></li><li><a href=https://db-engines.com/en/system/Cassandra target=_blank rel="noopener noreffer">Cassandra</a></li><li><a href=http://bsonspec.org/ target=_blank rel="noopener noreffer">BSON</a></li><li><a href=http://mysql.taobao.org/monthly/2018/09/06/ target=_blank rel="noopener noreffer">MongoDB · 引擎特性 · MongoDB索引原理</a></li><li><a href=http://datawarehouse4u.info/OLTP-vs-OLAP.html target=_blank rel="noopener noreffer">OLTP-vs-OLAP</a></li><li><a href=https://www.jianshu.com/p/4e412f48e820 target=_blank rel="noopener noreffer">聊聊MySQL、HBase、ES的特点和区别</a></li><li><a href=http://mysql.taobao.org/monthly/2016/02/01/ target=_blank rel="noopener noreffer">MySQL · 引擎特性 · InnoDB 文件系统之文件物理结构</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2018-09-27</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记" data-hashtags=数据库><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-hashtag=数据库><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记"><i data-svg-src=https://www.elonzh.com/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记"><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记" data-description><i data-svg-src=https://www.elonzh.com/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记" data-description><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.elonzh.com/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/ data-title="数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=https://www.elonzh.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=https://www.elonzh.com/>主页</a></span></section></div><div class=post-nav><a href=https://www.elonzh.com/%E5%A5%87%E7%89%B9%E7%9A%84%E4%B8%80%E7%94%9F%E4%B9%A6%E8%AF%84/ class=prev rel=prev title=《奇特的一生》书评><i class="fas fa-angle-left fa-fw"></i>《奇特的一生》书评</a>
<a href=https://www.elonzh.com/%E8%AE%B0%E4%B8%80%E6%AC%A1-elastic-apm-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/ class=next rel=next title="记一次 Elastic APM 性能调优">记一次 Elastic APM 性能调优<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.68.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.elonzh.com/ target=_blank>Elon Zhou</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://www.elonzh.com/lib/katex/katex.min.css><link rel=stylesheet href=https://www.elonzh.com/lib/katex/copy-tex.min.css><link rel=stylesheet href=https://www.elonzh.com/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=https://elonzh.disqus.com/embed.js defer></script><script type=text/javascript src=https://www.elonzh.com/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/lunr/lunr.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/sharer/sharer.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/katex/katex.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/katex/auto-render.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/katex/copy-tex.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/katex/mhchem.min.js></script><script type=text/javascript src=https://www.elonzh.com/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":30},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type=text/javascript src=https://www.elonzh.com/js/theme.min.js></script></body></html>